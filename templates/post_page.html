{{ define "title" }}–ü–æ—Å—Ç ‚Äî {{ .Post.Title }}{{ end }} {{ define "content" }}
<style>
	.reply-comment {
		margin-left: 30px;
		border-left: 2px solid #e0e0e0;
		padding-left: 15px;
	}

	.reply-link {
		margin-left: 8px;
		color: #007bff;
		text-decoration: none;
		font-size: 14px;
	}

	.reply-link:hover {
		text-decoration: underline;
	}

	.reply-form {
		margin-top: 10px;
		padding: 15px;
		background: #f8f9fa;
		border-radius: 8px;
		border: 1px solid #dee2e6;
	}

	.reply-form textarea {
		width: 100%;
		height: 80px;
		padding: 8px;
		border: 1px solid #ced4da;
		border-radius: 4px;
		resize: vertical;
		margin-bottom: 10px;
	}

	.reply-buttons {
		display: flex;
		gap: 10px;
	}

	.reply-buttons button {
		padding: 8px 16px;
		border: none;
		border-radius: 4px;
		cursor: pointer;
		font-size: 14px;
	}

	.reply-buttons button[type='submit'] {
		background: #28a745;
		color: white;
	}

	.reply-buttons button[type='submit']:hover {
		background: #218838;
	}

	.cancel-reply {
		background: #6c757d;
		color: white;
	}

	.cancel-reply:hover {
		background: #5a6268;
	}

	.image-upload-section {
		margin: 10px 0;
	}

	.image-upload-label {
		display: inline-block;
		padding: 8px 12px;
		background: #f8f9fa;
		border: 2px dashed #dee2e6;
		border-radius: 4px;
		cursor: pointer;
		color: #6c757d;
		font-size: 14px;
		transition: all 0.3s ease;
	}

	.image-upload-label:hover {
		background: #e9ecef;
		border-color: #adb5bd;
	}

	.image-upload-input {
		display: none;
	}

	.image-preview {
		margin-top: 10px;
		text-align: center;
	}

	.image-preview img {
		max-width: 200px;
		max-height: 150px;
		border-radius: 4px;
		border: 1px solid #dee2e6;
	}

	.remove-image {
		display: block;
		margin: 5px auto 0;
		padding: 4px 8px;
		background: #dc3545;
		color: white;
		border: none;
		border-radius: 3px;
		cursor: pointer;
		font-size: 12px;
	}

	.remove-image:hover {
		background: #c82333;
	}
</style>
<article>
	<h2>{{ .Post.Title }}</h2>
	<div>
		<small
			>–ê–≤—Ç–æ—Ä ID: {{ .Post.AuthorID }} ¬∑ –î–æ—Å–∫–∞ ID: {{ .Post.BoardID }}</small
		>
	</div>
	<div style="margin: 12px 0; white-space: pre-wrap">{{ .Post.Content }}</div>
	{{ if .Post.ImageData }}
	<div style="margin-top: 12px">
		<img
			src="/post/{{ .Post.ID }}/image"
			alt="image"
			style="max-width: 100%; height: auto"
		/>
	</div>
	{{ end }} {{ if .Post.LinkURL }}
	<div style="margin-top: 12px">
		<a href="{{ .Post.LinkURL }}" target="_blank" rel="noopener">–°—Å—ã–ª–∫–∞</a>
	</div>
	{{ end }}
	<div style="margin-top: 12px">
		<small
			>–°–æ–∑–¥–∞–Ω: {{ .Post.CreatedAt }} ¬∑ –û–±–Ω–æ–≤–ª—ë–Ω: {{ .Post.UpdatedAt }}</small
		>
	</div>
	<div style="margin-top: 16px">
		<a href="/post/{{ .Post.ID }}?edit=1">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
	</div>
</article>

<section style="margin-top: 24px">
	<h3>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ: {{ .Post.Likes }} ¬∑ –ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è: {{ .Post.Dislikes }}</h3>
	<a href="/post/{{ .Post.ID }}/like">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—å</a>
	<span> ¬∑ </span>
	<a href="/post/{{ .Post.ID }}/dislike">–ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è</a>
	<span style="margin-left: 12px; color: #888"></span>
</section>

<section style="margin-top: 24px">
	<h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–í—Å–µ–≥–æ: {{ len .Post.Comments }})</h3>
	<form method="POST" action="/api/comment" enctype="multipart/form-data">
		<input type="hidden" name="post_id" value="{{ .Post.ID }}" />
		<textarea name="content" rows="3" style="width: 100%" required></textarea>
		<div style="margin-top: 8px"><button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button></div>
	</form>
	<ul style="list-style: none; padding: 0; margin-top: 16px">
		{{ range .Post.Comments }}
		<li
			style="border-top: 1px solid #eee; padding: 8px 0"
			{{
			if
			.ParentID
			}}class="reply-comment"
			{{
			end
			}}
		>
			<div><strong>–ê–≤—Ç–æ—Ä ID: {{ .AuthorID }}</strong> ¬∑ {{ .CreatedAt }}</div>
			<div style="white-space: pre-wrap">{{ .Content }}</div>
			{{ if .ImageData }}
			<div style="margin-top: 8px">
				<img
					src="/comment/{{ .ID }}/image"
					alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏"
					style="
						max-width: 200px;
						max-height: 150px;
						border-radius: 4px;
						border: 1px solid #dee2e6;
					"
				/>
			</div>
			{{ end }}
			<div style="margin-top: 6px">
				<span>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ: {{ .Likes }} ¬∑ –ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è: {{ .Dislikes }}</span>
				<a
					href="/comment/{{ .ID }}/like?post_id={{ $.Post.ID }}"
					style="margin-left: 8px"
					>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—å</a
				>
				<a
					href="/comment/{{ .ID }}/dislike?post_id={{ $.Post.ID }}"
					style="margin-left: 6px"
					>–ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è</a
				>
				{{ if not .ParentID }}
				<a
					href="#reply-{{ .ID }}"
					class="reply-link"
					data-comment-id="{{ .ID }}"
				>
					üí¨ –û—Ç–≤–µ—Ç–∏—Ç—å
				</a>
				{{ end }}
				<form
					method="POST"
					action="/api/delete_comment"
					style="display: inline; margin-left: 8px"
				>
					<input type="hidden" name="post_id" value="{{ $.Post.ID }}" />
					<input type="hidden" name="comment_id" value="{{ .ID }}" />
					<button type="submit">–£–¥–∞–ª–∏—Ç—å</button>
				</form>
			</div>
			<!-- –§–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
			<div id="reply-{{ .ID }}" class="reply-form" style="display: none">
				<form
					method="POST"
					action="/api/comment"
					class="reply-form-content"
					enctype="multipart/form-data"
				>
					<input type="hidden" name="post_id" value="{{ $.Post.ID }}" />
					<input type="hidden" name="parent_id" value="{{ .ID }}" />
					<textarea
						name="content"
						placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç..."
						required
					></textarea>

					<div class="image-upload-section">
						<label for="reply-image-{{ .ID }}" class="image-upload-label">
							üì∑ –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
						</label>
						<input
							type="file"
							id="reply-image-{{ .ID }}"
							name="image"
							accept="image/*"
							class="image-upload-input"
						/>
						<div
							class="image-preview"
							id="reply-preview-{{ .ID }}"
							style="display: none"
						>
							<img src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" />
							<button
								type="button"
								class="remove-image"
								data-comment-id="{{ .ID }}"
							>
								‚ùå –£–¥–∞–ª–∏—Ç—å
							</button>
						</div>
					</div>

					<div class="reply-buttons">
						<button type="submit">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
						<button
							type="button"
							class="cancel-reply"
							data-comment-id="{{ .ID }}"
						>
							‚ùå –û—Ç–º–µ–Ω–∞
						</button>
					</div>
				</form>
			</div>
		</li>
		{{ else }}
		<li>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</li>
		{{ end }}
	</ul>
</section>
{{ end }}

<script>
	// –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç–∞ –≤ JavaScript
	window.postId = parseInt('{{ .Post.ID }}') || 0
</script>
<script src="/static/js/post-page.js"></script>
